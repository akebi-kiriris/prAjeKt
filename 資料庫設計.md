# Learnlink è³‡æ–™åº«è¨­è¨ˆæ–‡ä»¶

> **æœ€å¾Œæ›´æ–°**: 2024  
> **è³‡æ–™åº«å¼•æ“**: SQLiteï¼ˆé–‹ç™¼éšæ®µï¼‰â†’ PostgreSQLï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰  
> **ORM**: SQLAlchemy + Flask-Migrate

---

## ç›®éŒ„
1. [è³‡æ–™è¡¨æ¦‚è¦½](#è³‡æ–™è¡¨æ¦‚è¦½)
2. [ä½¿ç”¨è€…ç³»çµ±](#ä½¿ç”¨è€…ç³»çµ±)
3. [ç¾¤çµ„è¨Šæ¯ç³»çµ±](#ç¾¤çµ„è¨Šæ¯ç³»çµ±)
4. [ä»»å‹™ç®¡ç†ç³»çµ±](#ä»»å‹™ç®¡ç†ç³»çµ±)
5. [æ™‚ç¨‹ç®¡ç†](#æ™‚ç¨‹ç®¡ç†)
6. [å¾…è¾¦äº‹é …](#å¾…è¾¦äº‹é …)
7. [å»ºè­°æ–°å¢è³‡æ–™è¡¨](#å»ºè­°æ–°å¢è³‡æ–™è¡¨)
8. [ç´¢å¼•ç­–ç•¥](#ç´¢å¼•ç­–ç•¥)
9. [è³‡æ–™å®Œæ•´æ€§ç´„æŸ](#è³‡æ–™å®Œæ•´æ€§ç´„æŸ)

---

## è³‡æ–™è¡¨æ¦‚è¦½

### ç¾æœ‰è³‡æ–™è¡¨ï¼ˆå·²å¯¦ä½œï¼‰
| è³‡æ–™è¡¨åç¨± | ç”¨é€” | æ¨¡å‹æª”æ¡ˆ |
|----------|------|---------|
| `users` | ä½¿ç”¨è€…å¸³è™Ÿèˆ‡å€‹äººè³‡æ–™ | `models/user.py` |
| `groups` | ç¾¤çµ„ä¸»æª” | `models/group.py` |
| `group_members` | ç¾¤çµ„æˆå“¡é—œä¿‚ | `models/group.py` |
| `messages` | è¨Šæ¯å…§å®¹ | `models/message.py` |
| `message_reads` | è¨Šæ¯å·²è®€ç‹€æ…‹ | `models/message.py` |
| `tasks` | ä»»å‹™ä¸»æª” | `models/task.py` |
| `task_files` | ä»»å‹™é™„ä»¶æª”æ¡ˆ | `models/task.py` |
| `task_comments` | ä»»å‹™ç•™è¨€ | `models/task_comment.py` |
| `task_users` | ä»»å‹™æˆå“¡é—œä¿‚ | `models/task_user.py` |
| `timelines` | æ™‚ç¨‹è¦åŠƒ | `models/timeline.py` |
| `timeline_users` | æ™‚ç¨‹åƒèˆ‡è€… | `models/timeline_user.py` |
| `todos` | å¾…è¾¦äº‹é … | `models/todo.py` |
| `notifications` | é€šçŸ¥ç³»çµ± | `models/notification.py` |
| `activity_logs` | æ´»å‹•æ—¥èªŒ | `models/activity_log.py` |

---

## ä½¿ç”¨è€…ç³»çµ±

### usersï¼ˆä½¿ç”¨è€…å¸³è™Ÿï¼‰

**ç”¨é€”**: å„²å­˜ä½¿ç”¨è€…åŸºæœ¬è³‡è¨Šèˆ‡ç™»å…¥æ†‘è­‰

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | ä½¿ç”¨è€… IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `name` | String(100) | ä½¿ç”¨è€…å§“å | NOT NULL |
| `username` | String(50) | å”¯ä¸€ç”¨æˆ¶åï¼ˆå¦‚ @john_doeï¼‰ | UNIQUE, NULLABLE |
| `email` | String(120) | é›»å­éƒµä»¶ | UNIQUE, NOT NULL |
| `password` | String(256) | å¯†ç¢¼é›œæ¹Šå€¼ | NOT NULL |
| `phone` | String(20) | é›»è©±è™Ÿç¢¼ | NULLABLE |
| `avatar` | String(500) | é ­åƒè·¯å¾‘ | NULLABLE |
| `bio` | Text | å€‹äººç°¡ä»‹ | NULLABLE |
| `is_active` | Boolean | å¸³è™Ÿç‹€æ…‹ | DEFAULT TRUE |
| `last_login_at` | DateTime | æœ€å¾Œç™»å…¥æ™‚é–“ | NULLABLE |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| `updated_at` | DateTime | æ›´æ–°æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP, ON UPDATE |

**ç´¢å¼•**:
- PRIMARY: `id`
- UNIQUE: `email`
- UNIQUE: `username`
- INDEX: `created_at`ï¼ˆç”¨æ–¼æ’åºï¼‰

**å·²ç§»é™¤æ¬„ä½**ï¼ˆèª²ç¨‹ç›¸é—œï¼‰:
- ~~`student_id`~~ - å­¸è™Ÿ
- ~~`department`~~ - ç§‘ç³»
- ~~`entry_year`~~ - å…¥å­¸å¹´ä»½
- ~~`grade`~~ - å¹´ç´š
- ~~`class_id`~~ - ç­ç´š ID

**å°æ‡‰æ¨¡å‹**: `backend/models/user.py` â†’ `User`

**é—œè¯é—œä¿‚**:
- `1:N` â†’ `todos`
- `N:M` â†’ `groups` (through `group_members`)
- `1:N` â†’ `messages`ï¼ˆç™¼é€è€…ï¼‰

---

## ç¾¤çµ„è¨Šæ¯ç³»çµ±

### groupsï¼ˆç¾¤çµ„ä¸»æª”ï¼‰

**ç”¨é€”**: å„²å­˜ç¾¤çµ„åŸºæœ¬è³‡è¨Š

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `group_id` | Integer | ç¾¤çµ„ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `group_name` | String(100) | ç¾¤çµ„åç¨± | NOT NULL |
| `group_type` | String(50) | ç¾¤çµ„é¡å‹ | NULLABLE |
| `group_inviteCode` | String(50) | é‚€è«‹ç¢¼ | UNIQUE, NULLABLE |
| `created_by` | Integer | å»ºç«‹è€… ID | FOREIGN KEY â†’ users.id |
| `description` | Text | ç¾¤çµ„æè¿° | NULLABLE |
| `avatar` | String(500) | ç¾¤çµ„é ­åƒ | NULLABLE |
| `is_active` | Boolean | æ˜¯å¦å•Ÿç”¨ | DEFAULT TRUE |
| `max_members` | Integer | æˆå“¡ä¸Šé™ | DEFAULT 50 |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| `updated_at` | DateTime | æ›´æ–°æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP, ON UPDATE |

**ç´¢å¼•**:
- PRIMARY: `group_id`
- UNIQUE: `group_inviteCode`

**å°æ‡‰æ¨¡å‹**: `backend/models/group.py` â†’ `Group`

**é—œè¯é—œä¿‚**:
- `N:M` â†’ `users` (through `group_members`)
- `1:N` â†’ `messages`

---

### group_membersï¼ˆç¾¤çµ„æˆå“¡ï¼‰

**ç”¨é€”**: å¤šå°å¤šé—œè¯è¡¨ï¼Œè™•ç†ä½¿ç”¨è€…èˆ‡ç¾¤çµ„çš„é—œä¿‚

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | è¨˜éŒ„ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| `group_id` | Integer | ç¾¤çµ„ ID | FOREIGN KEY â†’ groups.group_id |

**ç´¢å¼•**:
- PRIMARY: `id`
- UNIQUE: `(user_id, group_id)` çµ„åˆå”¯ä¸€ç´¢å¼•
- INDEX: `user_id`, `group_id`ï¼ˆæŸ¥è©¢æœ€ä½³åŒ–ï¼‰

**å°æ‡‰æ¨¡å‹**: `backend/models/group.py` â†’ `GroupMember`

---

### messagesï¼ˆè¨Šæ¯å…§å®¹ï¼‰

**ç”¨é€”**: å„²å­˜ç¾¤çµ„è¨Šæ¯

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `message_id` | Integer | è¨Šæ¯ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `group_id` | Integer | ç¾¤çµ„ ID | FOREIGN KEY â†’ groups.group_id |
| `sender_id` | Integer | ç™¼é€è€… ID | FOREIGN KEY â†’ users.id |
| `message_text` | Text | è¨Šæ¯å…§å®¹ | NOT NULL |
| `message_type` | String(20) | è¨Šæ¯é¡å‹ | DEFAULT 'text' (text/image/file/system) |
| `attachment_url` | String(500) | é™„ä»¶è·¯å¾‘ | NULLABLE |
| `is_deleted` | Boolean | æ˜¯å¦åˆªé™¤ï¼ˆè»Ÿåˆªé™¤ï¼‰ | DEFAULT FALSE |
| `reply_to` | Integer | å›è¦†è¨Šæ¯ ID | FOREIGN KEY â†’ messages.message_id |
| `sent_at` | DateTime | ç™¼é€æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| `edited_at` | DateTime | ç·¨è¼¯æ™‚é–“ | NULLABLE |

**ç´¢å¼•**:
- PRIMARY: `message_id`
- INDEX: `group_id, sent_at`ï¼ˆç¾¤çµ„è¨Šæ¯åˆ—è¡¨æŸ¥è©¢ï¼‰
- INDEX: `sender_id`

**å°æ‡‰æ¨¡å‹**: `backend/models/message.py` â†’ `Message`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `groups`
- `N:1` â†’ `users`ï¼ˆç™¼é€è€…ï¼‰
- `1:N` â†’ `message_reads`

---

### message_readsï¼ˆè¨Šæ¯å·²è®€ç‹€æ…‹ï¼‰

**ç”¨é€”**: è¿½è¹¤è¨Šæ¯å·²è®€ç‹€æ…‹

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | è¨˜éŒ„ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `message_id` | Integer | è¨Šæ¯ ID | FOREIGN KEY â†’ messages.message_id |
| `user_id` | Integer | å·²è®€ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| `read_at` | DateTime | å·²è®€æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- UNIQUE: `(message_id, user_id)` çµ„åˆå”¯ä¸€ç´¢å¼•
- INDEX: `message_id`, `user_id`

**å°æ‡‰æ¨¡å‹**: `backend/models/message.py` â†’ `MessageRead`

---

## ä»»å‹™ç®¡ç†ç³»çµ±

### tasksï¼ˆä»»å‹™ä¸»æª”ï¼‰

**ç”¨é€”**: å„²å­˜ä»»å‹™è³‡è¨Š

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `task_id` | Integer | ä»»å‹™ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | å»ºç«‹è€… ID | FOREIGN KEY â†’ users.id |
| `name` | String(200) | ä»»å‹™åç¨± | NOT NULL |
| `completed` | Boolean | æ˜¯å¦å®Œæˆ | DEFAULT FALSE |
| `timeline_id` | Integer | æ‰€å±¬æ™‚ç¨‹ ID | NULLABLE |
| `task_remark` | Text | ä»»å‹™å‚™è¨» | NULLABLE |
| `isWork` | Integer | æ˜¯å¦ç‚ºä½œæ¥­ | DEFAULT 0 |
| `assistant` | String(255) | å”åŠ©è€… | NULLABLE |
| `priority` | Integer | å„ªå…ˆç´š (1:é«˜ 2:ä¸­ 3:ä½) | DEFAULT 2 |
| `status` | String(20) | ä»»å‹™ç‹€æ…‹ | DEFAULT 'pending' |
| `tags` | String(255) | æ¨™ç±¤ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰ | NULLABLE |
| `estimated_hours` | Float | é ä¼°å·¥æ™‚ | NULLABLE |
| `actual_hours` | Float | å¯¦éš›å·¥æ™‚ | NULLABLE |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| `start_date` | DateTime | é–‹å§‹æ—¥æœŸ | NULLABLE |
| `end_date` | DateTime | çµæŸæ—¥æœŸ | NULLABLE |
| `updated_at` | DateTime | æ›´æ–°æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP, ON UPDATE |

**ç´¢å¼•**:
- PRIMARY: `task_id`
- INDEX: `user_id`, `completed`
- INDEX: `timeline_id`
- INDEX: `created_at`
- INDEX: `priority`, `status`

---

### task_filesï¼ˆä»»å‹™é™„ä»¶ï¼‰

**ç”¨é€”**: å„²å­˜ä»»å‹™ç›¸é—œæª”æ¡ˆè³‡è¨Š

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `file_id` | Integer | æª”æ¡ˆ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `task_id` | Integer | æ‰€å±¬ä»»å‹™ ID | FOREIGN KEY â†’ tasks.task_id |
| `file_name` | String(255) | æª”æ¡ˆåç¨± | NOT NULL |
| `file_path` | String(500) | æª”æ¡ˆè·¯å¾‘ | NOT NULL |
| `file_size` | Integer | æª”æ¡ˆå¤§å°ï¼ˆbytesï¼‰ | NULLABLE |
| `uploaded_by` | Integer | ä¸Šå‚³è€… ID | FOREIGN KEY â†’ users.id |
| `uploaded_at` | DateTime | ä¸Šå‚³æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `file_id`
- INDEX: `task_id`, `uploaded_by`

**å°æ‡‰æ¨¡å‹**: `backend/models/task.py` â†’ `TaskFile`

---

## æ™‚ç¨‹ç®¡ç†

### timelinesï¼ˆæ™‚ç¨‹è¦åŠƒï¼‰

**ç”¨é€”**: å„²å­˜æ™‚ç¨‹è¨ˆç•«

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | æ™‚ç¨‹ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | å»ºç«‹è€… ID | FOREIGN KEY â†’ users.id |
| `name` | String(200) | æ™‚ç¨‹åç¨± | NOT NULL |
| `start_date` | Date | é–‹å§‹æ—¥æœŸ | NULLABLE |
| `end_date` | Date | çµæŸæ—¥æœŸ | NULLABLE |
| `color` | String(20) | é¡¯ç¤ºé¡è‰² | DEFAULT '#007bff' |
| `remark` | Text | å‚™è¨» | NULLABLE |
| `progress` | Integer | é€²åº¦ç™¾åˆ†æ¯” | DEFAULT 0 |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- INDEX: `user_id`
- INDEX: `start_date, end_date`

**å°æ‡‰æ¨¡å‹**: `backend/models/timeline.py` â†’ `Timeline`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `users`ï¼ˆå»ºç«‹è€…ï¼‰
- `N:M` â†’ `users`ï¼ˆthrough `timeline_users`ï¼Œæ™‚ç¨‹åƒèˆ‡è€…ï¼‰

---

## å¾…è¾¦äº‹é …

### todosï¼ˆå¾…è¾¦äº‹é …ï¼‰

**ç”¨é€”**: å€‹äººå¾…è¾¦æ¸…å–®

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | å¾…è¾¦ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | æ‰€å±¬ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| `title` | String(200) | å¾…è¾¦æ¨™é¡Œ | NOT NULL |
| `content` | Text | å¾…è¾¦è©³ç´°å…§å®¹ | NULLABLE |
| `type` | String(50) | å¾…è¾¦é¡å‹ | NULLABLE |
| `deadline` | Date | æˆªæ­¢æ—¥æœŸ | NULLABLE |
| `completed` | Boolean | æ˜¯å¦å®Œæˆ | DEFAULT FALSE |
| `priority` | Integer | å„ªå…ˆç´š (1:é«˜ 2:ä¸­ 3:ä½) | DEFAULT 2 |
| `order` | Integer | è‡ªè¨‚æ’åº | NULLABLE |
| `completed_at` | DateTime | å®Œæˆæ™‚é–“ | NULLABLE |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| `updated_at` | DateTime | æ›´æ–°æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP, ON UPDATE |

**ç´¢å¼•**:
- PRIMARY: `id`
- INDEX: `user_id, completed`ï¼ˆæŸ¥è©¢ä½¿ç”¨è€…æœªå®Œæˆé …ç›®ï¼‰
- INDEX: `deadline`

**å°æ‡‰æ¨¡å‹**: `backend/models/todo.py` â†’ `Todo`

**æ¬„ä½è®Šæ›´æ­·å²**:
- âœ… æ–°å¢ `title` æ¬„ä½ï¼ˆ2024ï¼‰
- âœ… æ–°å¢ `content` æ¬„ä½ï¼ˆ2024ï¼‰

---

---

## é€šçŸ¥ç³»çµ±

### notificationsï¼ˆé€šçŸ¥ï¼‰

**ç”¨é€”**: ç³»çµ±é€šçŸ¥èˆ‡æé†’

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | é€šçŸ¥ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | æ¥æ”¶è€… ID | FOREIGN KEY â†’ users.id |
| `type` | String(50) | é€šçŸ¥é¡å‹ | NOT NULL (task_assigned/message/comment/deadline/mention) |
| `title` | String(200) | é€šçŸ¥æ¨™é¡Œ | NOT NULL |
| `content` | Text | é€šçŸ¥å…§å®¹ | NULLABLE |
| `link` | String(500) | é»æ“Šå°å‘é€£çµ | NULLABLE |
| `is_read` | Boolean | æ˜¯å¦å·²è®€ | DEFAULT FALSE |
| `created_at` | DateTime | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- INDEX: `user_id, is_read`ï¼ˆæŸ¥è©¢æœªè®€é€šçŸ¥ï¼‰
- INDEX: `created_at`

**å°æ‡‰æ¨¡å‹**: `backend/models/notification.py` â†’ `Notification`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `users`ï¼ˆæ¥æ”¶è€…ï¼‰

---

### activity_logsï¼ˆæ´»å‹•æ—¥èªŒï¼‰

**ç”¨é€”**: è¨˜éŒ„ä½¿ç”¨è€…æ“ä½œæ­·å²

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | æ—¥èªŒ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `user_id` | Integer | æ“ä½œè€… ID | FOREIGN KEY â†’ users.id |
| `action` | String(50) | æ“ä½œé¡å‹ | NOT NULL (created/updated/deleted/completed) |
| `entity_type` | String(50) | å¯¦é«”é¡å‹ | NOT NULL (task/message/todo/timeline/group) |
| `entity_id` | Integer | å¯¦é«” ID | NOT NULL |
| `description` | Text | æ“ä½œæè¿° | NULLABLE |
| `ip_address` | String(45) | IP ä½å€ | NULLABLE (æ”¯æ´ IPv6) |
| `created_at` | DateTime | æ“ä½œæ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- INDEX: `(entity_type, entity_id)`ï¼ˆæŸ¥è©¢ç‰¹å®šå¯¦é«”çš„æ­·å²ï¼‰
- INDEX: `(user_id, created_at)`ï¼ˆæŸ¥è©¢ä½¿ç”¨è€…æ“ä½œæ­·å²ï¼‰

**å°æ‡‰æ¨¡å‹**: `backend/models/activity_log.py` â†’ `ActivityLog`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `users`ï¼ˆæ“ä½œè€…ï¼‰

---

## ä»»å‹™ç•™è¨€ç³»çµ±

### task_commentsï¼ˆä»»å‹™ç•™è¨€ï¼‰

**ç”¨é€”**: ä»»å‹™å”ä½œç•™è¨€åŠŸèƒ½

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `comment_id` | Integer | ç•™è¨€ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `task_id` | Integer | ä»»å‹™ ID | FOREIGN KEY â†’ tasks.task_id |
| `user_id` | Integer | ç•™è¨€è€… ID | FOREIGN KEY â†’ users.id |
| `task_message` | String(255) | ç•™è¨€å…§å®¹ | NOT NULL |
| `created_at` | DateTime | ç•™è¨€æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `comment_id`
- INDEX: `task_id, created_at`ï¼ˆæŒ‰æ™‚é–“æ’åºï¼‰
- INDEX: `user_id`

**å°æ‡‰æ¨¡å‹**: `backend/models/task_comment.py` â†’ `TaskComment`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `tasks`
- `N:1` â†’ `users`ï¼ˆç•™è¨€è€…ï¼‰

---

### task_usersï¼ˆä»»å‹™æˆå“¡ï¼‰

**ç”¨é€”**: ä»»å‹™å¤šäººå”ä½œé—œè¯è¡¨

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | è¨˜éŒ„ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `task_id` | Integer | ä»»å‹™ ID | FOREIGN KEY â†’ tasks.task_id |
| `user_id` | Integer | æˆå“¡ ID | FOREIGN KEY â†’ users.id |
| `role` | Integer | è§’è‰² (0: è² è²¬äºº, 1: å”ä½œè€…) | NULLABLE |
| `assigned_at` | DateTime | æŒ‡æ´¾æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- UNIQUE: `(task_id, user_id)` çµ„åˆå”¯ä¸€ç´¢å¼•
- INDEX: `task_id`, `user_id`

**å°æ‡‰æ¨¡å‹**: `backend/models/task_user.py` â†’ `TaskUser`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `tasks`
- `N:1` â†’ `users`

---

### timeline_usersï¼ˆæ™‚ç¨‹åƒèˆ‡è€…ï¼‰

**ç”¨é€”**: æ™‚ç¨‹å¤šäººå…±äº«é—œè¯è¡¨

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç´„æŸ |
|---------|------|------|------|
| `id` | Integer | è¨˜éŒ„ IDï¼ˆä¸»éµï¼‰ | PRIMARY KEY, AUTO_INCREMENT |
| `timeline_id` | Integer | æ™‚ç¨‹ ID | FOREIGN KEY â†’ timelines.id |
| `user_id` | Integer | åƒèˆ‡è€… ID | FOREIGN KEY â†’ users.id |
| `role` | Integer | è§’è‰² (0: è² è²¬äºº, 1: å”ä½œè€…) | NULLABLE |
| `joined_at` | DateTime | åŠ å…¥æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY: `id`
- UNIQUE: `(timeline_id, user_id)` çµ„åˆå”¯ä¸€ç´¢å¼•
- INDEX: `timeline_id`, `user_id`

**å°æ‡‰æ¨¡å‹**: `backend/models/timeline_user.py` â†’ `TimelineUser`

**é—œè¯é—œä¿‚**:
- `N:1` â†’ `timelines`
- `N:1` â†’ `users`

---

## ç´¢å¼•ç­–ç•¥

### ä¸»è¦ç´¢å¼•
æ‰€æœ‰ä¸»éµè‡ªå‹•å»ºç«‹ PRIMARY KEY ç´¢å¼•ã€‚

### æŸ¥è©¢æœ€ä½³åŒ–ç´¢å¼•
- **ä½¿ç”¨è€…ç™»å…¥æŸ¥è©¢**: `users.email` (UNIQUE)
- **ç¾¤çµ„è¨Šæ¯åˆ—è¡¨**: `messages (group_id, sent_at)`
- **ä»»å‹™åˆ—è¡¨**: `tasks (created_by, task_status)`
- **å¾…è¾¦æŸ¥è©¢**: `todos (user_id, completed)`
- **å·²è®€ç‹€æ…‹**: `message_reads (message_id, user_id)`

### å¤–éµç´¢å¼•
æ‰€æœ‰å¤–éµæ¬„ä½éƒ½æ‡‰å»ºç«‹ç´¢å¼•ä»¥æå‡ JOIN æ•ˆèƒ½ã€‚

---

## è³‡æ–™å®Œæ•´æ€§ç´„æŸ

### å¤–éµåˆªé™¤ç­–ç•¥

| çˆ¶è³‡æ–™è¡¨ | å­è³‡æ–™è¡¨ | åˆªé™¤ç­–ç•¥ |
|---------|---------|---------|
| `users` | `todos` | CASCADEï¼ˆåˆªé™¤ä½¿ç”¨è€…æ™‚ä¸€ä½µåˆªé™¤å¾…è¾¦ï¼‰ |
| `users` | `group_members` | CASCADEï¼ˆé€€å‡ºæ‰€æœ‰ç¾¤çµ„ï¼‰ |
| `groups` | `group_members` | CASCADEï¼ˆåˆªé™¤ç¾¤çµ„æ™‚æ¸…é™¤æˆå“¡é—œä¿‚ï¼‰ |
| `groups` | `messages` | CASCADEï¼ˆåˆªé™¤ç¾¤çµ„æ™‚åˆªé™¤è¨Šæ¯ï¼‰ |
| `messages` | `message_reads` | CASCADEï¼ˆè¨Šæ¯åˆªé™¤æ™‚æ¸…é™¤å·²è®€è¨˜éŒ„ï¼‰ |
| `tasks` | `task_files` | CASCADEï¼ˆä»»å‹™åˆªé™¤æ™‚åˆªé™¤é™„ä»¶ï¼‰ |
| `tasks` | `task_comments` | CASCADEï¼ˆä»»å‹™åˆªé™¤æ™‚åˆªé™¤ç•™è¨€ï¼‰ |
| `tasks` | `task_users` | CASCADEï¼ˆä»»å‹™åˆªé™¤æ™‚æ¸…é™¤æˆå“¡é—œä¿‚ï¼‰ |
| `timelines` | `timeline_users` | CASCADEï¼ˆæ™‚ç¨‹åˆªé™¤æ™‚æ¸…é™¤åƒèˆ‡è€…é—œä¿‚ï¼‰ |
| `users` | `notifications` | CASCADEï¼ˆä½¿ç”¨è€…åˆªé™¤æ™‚åˆªé™¤é€šçŸ¥ï¼‰ |
| `users` | `activity_logs` | SET NULLï¼ˆä¿ç•™æ—¥èªŒä½†ç§»é™¤ä½¿ç”¨è€…é—œè¯ï¼‰ |

### CHECK ç´„æŸå»ºè­°

```sql
-- ä½¿ç”¨è€…ç‹€æ…‹æª¢æŸ¥
ALTER TABLE users ADD CONSTRAINT check_user_active 
  CHECK (is_active IN (0, 1));

-- ç¾¤çµ„é¡å‹æª¢æŸ¥
ALTER TABLE groups ADD CONSTRAINT check_group_type 
  CHECK (group_type IN ('task', 'class', 'project'));

-- è¨Šæ¯é¡å‹æª¢æŸ¥
ALTER TABLE messages ADD CONSTRAINT check_message_type 
  CHECK (message_type IN ('text', 'image', 'file', 'system'));

-- ä»»å‹™å„ªå…ˆç´šæª¢æŸ¥
ALTER TABLE tasks ADD CONSTRAINT check_task_priority 
  CHECK (priority IN (1, 2, 3));

-- ä»»å‹™ç‹€æ…‹æª¢æŸ¥
ALTER TABLE tasks ADD CONSTRAINT check_task_status 
  CHECK (status IN ('pending', 'in_progress', 'review', 'completed', 'cancelled'));

-- å¾…è¾¦å„ªå…ˆç´šæª¢æŸ¥
ALTER TABLE todos ADD CONSTRAINT check_todo_priority 
  CHECK (priority IN (1, 2, 3));

-- æ™‚ç¨‹æ—¥æœŸåˆç†æ€§
ALTER TABLE timelines ADD CONSTRAINT check_timeline_dates 
  CHECK (end_date IS NULL OR end_date >= start_date);

-- æª”æ¡ˆå¤§å°é™åˆ¶ï¼ˆä¾‹å¦‚ï¼šæœ€å¤§ 50MBï¼‰
ALTER TABLE task_files ADD CONSTRAINT check_file_size 
  CHECK (file_size IS NULL OR file_size <= 52428800);

-- é€šçŸ¥é¡å‹æª¢æŸ¥
ALTER TABLE notifications ADD CONSTRAINT check_notification_type 
  CHECK (type IN ('task_assigned', 'message', 'comment', 'deadline', 'mention'));

-- æ´»å‹•æ—¥èªŒæ“ä½œé¡å‹æª¢æŸ¥
ALTER TABLE activity_logs ADD CONSTRAINT check_activity_action 
  CHECK (action IN ('created', 'updated', 'deleted', 'completed'));

-- æ´»å‹•æ—¥èªŒå¯¦é«”é¡å‹æª¢æŸ¥
ALTER TABLE activity_logs ADD CONSTRAINT check_activity_entity 
  CHECK (entity_type IN ('task', 'message', 'todo', 'timeline', 'group'));
```

---

## è³‡æ–™åº«é·ç§»è¨˜éŒ„

### å·²åŸ·è¡Œé·ç§»
1. âœ… `todo add content field` - æ–°å¢ todos.content æ¬„ä½
2. âœ… `final remove user student_id entry_year grade fields` - ç§»é™¤èª²ç¨‹ç›¸é—œæ¬„ä½

### å¾…åŸ·è¡Œé·ç§»ï¼ˆé‡è¦ï¼‰
- [ ] åŸ·è¡Œ migration å‰µå»ºæ‰€æœ‰æ–°è¡¨èˆ‡æ–°æ¬„ä½
  - task_comments, task_users, timeline_users
  - notifications, activity_logs
- [ ] ç‚ºç¾æœ‰è¡¨æ–°å¢æ¬„ä½ï¼š
  - users: avatar, bio, is_active, last_login_at, updated_at
  - groups: created_by, description, avatar, is_active, max_members, updated_at
  - messages: message_type, attachment_url, is_deleted, reply_to, edited_at
  - tasks: assistant, priority, status, tags, estimated_hours, actual_hours, updated_at
  - todos: priority, order, completed_at, updated_at
- [ ] ç§»é™¤å¤šé¤˜æ¬„ä½ï¼š
  - tasks: assignee, assignee_idï¼ˆæ”¹ç”¨ task_users é—œè¯è¡¨ï¼‰
- [ ] æ–°å¢ CHECK ç´„æŸ
- [ ] æ–°å¢è¤‡åˆç´¢å¼•

### Migration åŸ·è¡ŒæŒ‡ä»¤
```bash
cd backend
flask db migrate -m "add all new fields and tables - comprehensive update"
flask db upgrade
```

---

## ERD é—œè¯åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€1:Nâ”€â”€â†’ todos
     â”œâ”€â”€1:Nâ”€â”€â†’ tasks (created_by)
     â”œâ”€â”€1:Nâ”€â”€â†’ timelines (created_by)
     â”œâ”€â”€1:Nâ”€â”€â†’ groups (created_by)
     â”œâ”€â”€1:Nâ”€â”€â†’ messages (sender_id)
     â”œâ”€â”€1:Nâ”€â”€â†’ notifications (receiver)
     â”œâ”€â”€1:Nâ”€â”€â†’ activity_logs (actor)
     â”‚
     â””â”€â”€N:Mâ”€â”€â†’ groups
         â”‚      (through group_members)
         â”‚
         â””â”€â”€1:Nâ”€â”€â†’ messages


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tasks  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€1:Nâ”€â”€â†’ task_files
    â”œâ”€â”€1:Nâ”€â”€â†’ task_comments
    â””â”€â”€N:Mâ”€â”€â†’ users (through task_users)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ timelines â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
      â””â”€â”€N:Mâ”€â”€â†’ users (through timeline_users)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ messages â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â””â”€â”€N:1â”€â”€â†’ messages (reply_to, è‡ªæˆ‘é—œè¯)
```

---

## åƒè€ƒè³‡æ–™

- **ç¾æœ‰æ¨¡å‹æª”æ¡ˆ**: `backend/models/`
- **èˆŠè³‡æ–™åº«çµæ§‹**: `learnlink0526.sql`
- **é·ç§»æª”æ¡ˆ**: `backend/migrations/versions/`
- **é‡æ§‹è¨ˆç•«**: [é‡æ§‹è¨ˆç•«.md](é‡æ§‹è¨ˆç•«.md)

---

**å‚™è¨»**:
- æ‰€æœ‰èª²ç¨‹ç›¸é—œè³‡æ–™è¡¨ï¼ˆcourses, teachers, selected_courses ç­‰ï¼‰å·²å®Œå…¨ç§»é™¤
- task_comments, task_users, timeline_users, notifications, activity_logs å·²å‰µå»ºæ¨¡å‹ï¼Œå¾…åŸ·è¡Œ migration
- **å·²ç§»é™¤å¤šé¤˜æ¬„ä½**: tasks è¡¨çš„ assignee å’Œ assignee_idï¼ˆæ”¹ç”¨ task_users é—œè¯è¡¨ç®¡ç†ä»»å‹™æˆå“¡ï¼‰
- æ‰€æœ‰æ–°å¢æ¬„ä½éƒ½å·²åŠ å…¥æ¨¡å‹ï¼Œå»ºè­°ä¸€æ¬¡æ€§åŸ·è¡Œ migration é¿å…å¤šæ¬¡ä¿®æ”¹
- å»ºè­°æ¡ç”¨åˆ‡ç‰‡å¼é–‹ç™¼é€æ­¥å®Œå–„åŠŸèƒ½

---

## é‡è¦æé†’

### é—œæ–¼ models/__init__.py çš„ä½œç”¨
- **æ¨¡å‹è¨»å†Š**: `__init__.py` å°å…¥æ‰€æœ‰æ¨¡å‹é¡åˆ¥ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡çµ„ä½¿ç”¨
- **Flask-Migrate åµæ¸¬**: å¿…é ˆåœ¨ `app.py` ä¸­å°å…¥æ¨¡å‹ï¼Œå¦å‰‡ `flask db migrate` ç„¡æ³•åµæ¸¬åˆ°è¡¨çµæ§‹
- **å·²åœ¨ app.py ä¸­åŠ å…¥**: ä½¿ç”¨ `with app.app_context()` å°å…¥æ‰€æœ‰æ¨¡å‹ï¼Œç¢ºä¿ migration èƒ½æ­£ç¢ºåŸ·è¡Œ

### Migration å‰çš„æª¢æŸ¥æ¸…å–®
1. âœ… æ‰€æœ‰æ¨¡å‹æª”æ¡ˆå·²æ›´æ–°
2. âœ… `models/__init__.py` å·²å°å…¥æ‰€æœ‰æ–°æ¨¡å‹
3. âœ… `app.py` å·²åœ¨ app_context ä¸­å°å…¥æ¨¡å‹
4. ğŸ”² åŸ·è¡Œ `flask db migrate` ç”Ÿæˆé·ç§»è…³æœ¬
5. ğŸ”² æª¢æŸ¥ç”Ÿæˆçš„é·ç§»è…³æœ¬æ˜¯å¦æ­£ç¢º
6. ğŸ”² åŸ·è¡Œ `flask db upgrade` æ‡‰ç”¨åˆ°è³‡æ–™åº«
7. ğŸ”² æ¸¬è©¦æ‰€æœ‰ API æ˜¯å¦éœ€è¦èª¿æ•´ï¼ˆç‰¹åˆ¥æ˜¯ tasks ç›¸é—œï¼Œå› ç‚ºç§»é™¤äº† assigneeï¼‰
